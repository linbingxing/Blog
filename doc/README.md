# Spring Cloud 知识体系

##  什么是微服务？

微服务最早由Martin Fowler与James Lewis于2014年共同提出，微服务架构风格是一种使用一套小服务来开发单个应用的方式途径，每个服务运行在自己的进程中，并使用轻量级机制通信，通常是HTTP API，这些服务基于业务能力构建，并能够通过自动化部署机制来独立部署，这些服务使用不同的编程语言实现，以及不同数据存储技术，并保持最低限度的集中式管理。

微服务是一种用于构建应用的架构方案。微服务架构有别于更为传统的单体式方案，可将应用拆分成多个核心功能。每个功能都被称为一项服务，可以单独构建和部署，这意味着各项服务在工作（和出现故障）时不会相互影响。

**“微服务”不是银弹**

微服务并不是一劳永逸的解决了所有的问题，相反的，如果不能正确的使用微服务，则有可能被微服务自身的限制拖入另一个泥潭：

- 分布式的代价。原本在单体应用中，很多简单的问题都会在分布式环境下被几何级的放大。例如分布式事务、分布式锁、远程调用等，不光要考虑如何实现他们，相关场景的异常处理也是必须要考虑到的问题。
- 协同代价。如果你经历过一个项目上线需要发布十几个应用，而这些应用又分别由多个团队在维护。你就能深刻的体会到协同是一件多么痛苦的事情了。
- 服务拆分需要很强的设计功力。微服务的各种优势，其中一个重要的基础是对服务领域的正确切分。如果使用了不合适的切分粒度，或者是错误的切分方法，都会让服务不能很好的实现高内聚低耦合的要求。

##  微服务架构 

微服务架构是目前构建互联网系统的主流架构体系。通常来说，我们认为架构的发展历程经历了这样一个历程：单体架构 -> SOA架构 -> 微服务架构。

通常来说我们看到的微服务架构如下图所示：

![Microservice_Architecture](images\Microservice_Architecture.png)

## 微服务组件

基于目前业界主流的微服务实现技术提炼了八大技术体系，包括服务通信、服务治理、服务路由、服务容错、服务网关、服务配置、服务安全和服务监控，如下图所示

![服务八大组件](images\服务八大组件.png)

上图中的每个技术体系都非常重要，下面来对它们分别展开介绍。

###  服务通信

网络通信是任何分布式系统的基础组件。网络通信本身涉及面很广，相对比较复杂，对于微服务架构而言，我们关注的是网络连接模式、I/O 模型和服务调用方式。

![服务通信](images\服务通信.png)

基于TCP协议的网络连接有两种基本方式，也就是通常所说的长连接和短连接。长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略。在微服务架构中，dubbo 框架采用的是长连接rpc方式，openfeign采用短连接http方式。

I/O 模型也有阻塞式 I/O 和非阻塞式 I/O 等多种实现方式。阻塞式 I/O 实现简单，而非阻塞式 I/O 的性能更好。在微服务架构中，以服务网关而言，像Netflix 的 Zuul就是阻塞式 I/O，而Spring 自研的 Spring Cloud Gateway则采用的是非阻塞式 I/O。

服务调用方式，也会有同步和异步调用两种方式。在微服务架构中，通常会采用异步转同步的实现机制，也就是说开发人员使用同步的方式进行方法调用，而框架本身会基于 Future 等机制实现异步的远程处理。

其他通信还可能基于消息通信、事件驱动的通信，有兴趣可以去了解。

###  服务治理

在微服务架构中，服务治理可以说是最为关键的一个技术组件，因为各个微服务需要通过服务治理实现自动化的注册和发现。如果尝试着用手动的方式来给每一个客户端来配置所有服务提供者的服务列表是一件非常困难的事，而且也不利于服务的动态扩缩容、健康检查等。

![服务注册发现流程](images\服务注册发现流程.png)

服务注册中心是保存服务调用所需的路由信息的存储仓库，也是服务提供者和服务消费者进行交互的媒介，充当着服务注册和发现服务器的作用。诸如 Dubbo、Spring Cloud 等主流的微服务框架都基于 Zookeeper、Eureka、Nacos 等分布式系统协调工具构建了服务注册中心。后续我们会对Nacos的服务注册、发现进行原理分析。

###  服务路由

当我们服务基于服务注册中心构建一个多台集群化的服务时，当客户端请求到达集群，如何确定由哪一台服务器进行请求响应呢？这就是服务路由问题。在Spring Cloud中，采用负载均衡是一种比较常见的路由方案，常见的客户端/服务器端负载均衡技术都可以完成服务路由。Spring Cloud 主要内置了 Ribbon 等客户端负载均衡组件。具体需要了解几种负载均衡算法，如何配置不同的负载均衡策略。

![注册中心与负载均衡结构示意图](images\注册中心与负载均衡结构示意图.png)



### 服务配置

###  服务网关

### 服务容错

###  服务安全

###  服务监控

